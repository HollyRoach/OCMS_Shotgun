'''
drop_fastqs.py
==============

:Author: Jethro Johnson

Purpose
-------

Provided with a fastq file fq1.

Provided with a text file (containing one fastq identifier per line), 
which specifiesd singletons to remove.

Will iterate over the fastq and drop any entries in the file. 
'''


import CGAT.Experiment as E
import CGAT.IOTools as IOTools
import CGAT.Fastq as Fastq

import pandas as pd

import os,re,sys


def main(argv=None):

    if argv is None:
        argv = sys.argv


    parser = E.OptionParser(
        version="%prog version: $Id$",
        usage=globals()["__doc__"])

    parser.add_option("-fq1", "--fastq1", dest="fastq1")
    parser.add_option("-dps", "--to-drop-single", dest='to_remove_singletons')
    parser.add_option("-o1", "--fastq-out1", dest="fq_out1")
    parser.add_option("-d1", "--fastq-drop1", dest="fq_dropped1")

    (options, args) = E.Start(parser)

    reads_to_remove = IOTools.openFile(to_remove_singletons).readlines()
    reads_to_remove = set([x.strip() for x in reads_to_remove])

    fastq_out = IOTools.openFile(fq_out1, 'w')
    fastq_host = IOTools.openFile(fq_dropped1, 'w')

    for read in Fastq.iterate(IOTools.openFile(fastq1)):
        if read.identifier.split()[0] in reads_to_remove:
            fastq_host.write("@%s\n%s\n+\n%s\n" %
                             (read.identifier,
                              read.seq,
                              read.quals))
        else:
            fastq_out.write("@%s\n%s\n+\n%s\n" %
                            (read.identifier,
                             read.seq,
                             read.quals))

    fastq_out.close()
    fastq_host.close()

if __name__=="__main__":
    sys.exit(main(sys.argv))
            
